<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>数据统计</title>
    <script src="static/assets/js/jquery-3.3.1.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flot-charts@0.8.3/excanvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flot-charts@0.8.3/jquery.flot.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery.flot@0.8.3/jquery.flot.pie.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery.flot@0.8.3/jquery.flot.time.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery.flot@0.8.3/jquery.flot.stack.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery.flot@0.8.3/jquery.flot.resize.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery.flot@0.8.3/jquery.flot.crosshair.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flot.curvedlines@1.1.1/curvedLines.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery.flot.tooltip@0.9.0/js/jquery.flot.tooltip.min.js"></script>
    <script src="static/assets/js/init/flot-chart-init.js"></script>
    <script src="static/assets/js/vendor/jquery-2.1.4.min.js"></script>
    <script src="static/assets/js/popper.min.js"></script>
    <script src="static/assets/js/bootstrap.min.js"></script>
    <script src="static/assets/js/jquery.matchHeight.min.js"></script>
    <script src="static/assets/js/main.js"></script>

    <!--<script src="static/assets/js/lib/data-table/datatables.min.js"></script>
    <script src="static/assets/js/lib/data-table/dataTables.bootstrap.min.js"></script>
    <script src="static/assets/js/lib/data-table/dataTables.buttons.min.js"></script>
    <script src="static/assets/js/lib/data-table/buttons.bootstrap.min.js"></script>
    <script src="static/assets/js/lib/data-table/jszip.min.js"></script>
    <script src="static/assets/js/lib/data-table/vfs_fonts.js"></script>
    <script src="static/assets/js/lib/data-table/buttons.html5.min.js"></script>
    <script src="static/assets/js/lib/data-table/buttons.print.min.js"></script>
    <script src="static/assets/js/lib/data-table/buttons.colVis.min.js"></script>
    <script src="static/assets/js/init/datatables-init.js"></script>-->



    <link rel="stylesheet" href="static/assets/css/normalize.css">
    <link rel="stylesheet" href="static/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="static/assets/css/font-awesome.min.css">
    <link rel="stylesheet" href="static/assets/css/themify-icons.css">
    <link rel="stylesheet" href="static/assets/css/pe-icon-7-filled.css">
    <link rel="stylesheet" href="static/assets/css/flag-icon.min.css">
    <link rel="stylesheet" href="static/assets/css/cs-skin-elastic.css">
    <link rel="stylesheet" href="static/assets/css/lib/datatable/dataTables.bootstrap.min.css">
    <link rel="stylesheet" href="static/assets/css/style.css">

    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800' rel='stylesheet' type='text/css'>

    <script src="http://echarts.baidu.com/build/dist/echarts.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>

    <script>
        $(function () {
            //loginuser:现登录用户
            $.get("user/findOne",{},function (luser) {
                fusername=luser.username;
                uid=luser.uid;
                $("#base_name").html(luser.name);
            });
            $("#currently").html(document.title)
            //当日报警数
            $.get("monitor/findTipToday",null,function (tipToday) {
                var ps = '<i class="fa fa-check"></i>';
                for (var i = 0; i < tipToday.length; i++) {
                    var tip = tipToday[i];
                    var p ='<p>'+tip.eq_name+'发生'+tip.type+'</p> <br/> ';
                    ps += p;
                }
                $("#tips").html(ps);
                var count = '<i class="fa fa-bell"></i> <span id="count" class="count bg-danger">'+tipToday.length+'</span>';
                $("#notification").html(count);
            });
        });
    </script>
    <script>

        $(function () {

            $.get("monitor/findData",null,function (datas) {

                var eqCount =  '<span class="count">'+datas.eqCount+'</span>';
                $("#eqCount").html(eqCount);

                var depCount = '<span class="count">'+datas.depCount+'</span>';
                $("#depCount").html(depCount);

                var alarmRate = '<span class="count">'+datas.alarmRate+'%</span>';
                $("#alarmRate").html(alarmRate);

                var failRate = '<span class="count">'+datas.failRate+'%</span>';
                $("#failRate").html(failRate);

                var alarmTotal = '<span>'+datas.alarmTotal+'</span>';
                $("#alarmTotal").html(alarmTotal);

                var alarmTody = '<span>'+datas.alarmTody+'</span>';
                $("#alarmTody").html(alarmTody);

                var failTotal = '<span>'+datas.failTotal+'</span>';
                $("#failTotal").html(failTotal);

                var failTody = '<span>'+datas.failTody+'</span>';
                $("#failTody").html(failTody);

            });

            var li = '<a href="#"><i class="menu-icon fa fa-laptop"></i>数据统计</a>';
            $("#now").html(li);

            plot();


        });
        function plot(){
            $.get("monitor/findData",null,function (datas) {


                // first chart
                let twoWeeksDays = datas.twoWeeksDays;
                let twoWeeksReportCounts = datas.twoWeeksReportCounts;
                let lineChartData = [];

                console.log(lineChartData);

                for (var i = 0; i < twoWeeksDays.length; i++) {
                    //lineChartData.push([twoWeeksDays[i], twoWeeksReportCounts[i]]);
                    lineChartData.push([twoWeeksDays[i] + 8 * 60 * 60 * 1000, twoWeeksReportCounts[i]]);
                }

                var chart1Options = {
                    series: {
                        lines: {
                            show: true
                        },
                        points: {
                            show: true
                        }
                    },
                    xaxis: {
                        mode: "time",
                        timeformat: "%m/%d",
                        minTickSize: [1, "day"]
                    },
                    /*xAxis : [{
                        type : 'category',
                        boundaryGap : false,
                        data :  [days[0], days[1], days[2], days[3], days[4], days[5], days[6], days[7], days[8], days[9],days[10],
                            days[11], days[12],days[13]]
                    }],*/
                    grid: {
                        hoverable: true
                    },
                    legend: {
                        show: false
                    },
                    grid: {
                        color: "#fff",
                        hoverable: true,
                        borderWidth: 0,
                        backgroundColor: 'transparent'
                    },
                    tooltip: {
                        show: true,
                        content: "y: %y"
                    }
                };
                var chart1Data = {
                    label: "chart1",
                    color: "#007BFF",
                    data: lineChartData
                };

                $.plot($("#chart1"), [chart1Data], chart1Options);
            });
        }

    </script>

</head>
<body>
<div class="right-panel">
    <div class="animated fadeIn">
        <div class="row col-lg-12">

            <div class='row col-lg-6' style="margin-top:10px">
                <div class="col-sm-6 col-lg-6">
                    <div class="card text-white bg-flat-color-3">
                        <div class="card-body">
                            <div class="card-left pt-1 float-left">
                                <h3 id="eqCount" class="mb-0 fw-r">
                                    <!--<span class="count">{{ data.equipmentCount }}</span>-->
                                </h3>
                                <p class="text-light mt-1 m-0">设备总数</p>
                            </div><!-- /.card-left -->

                            <div class="card-right float-right text-right">
                                <i class="icon fade-5 icon-lg pe-7s-users"></i>
                            </div><!-- /.card-right -->

                        </div>

                    </div>
                </div>

                <div class="col-sm-6 col-lg-6">
                    <div class="card text-white bg-flat-color-1">
                        <div class="card-body">
                            <div class="card-left pt-1 float-left">
                                <h3 id="depCount" class="mb-0 fw-r">
                                    <!--<span class="count">{{ data.departmentCount }}</span>-->
                                </h3>
                                <p class="text-light mt-1 m-0">单位总数</p>
                            </div><!-- /.card-left -->

                            <div class="card-right float-right text-right">
                                <i class="icon fade-5 icon-lg pe-7s-cart"></i>
                            </div><!-- /.card-right -->

                        </div>

                    </div>
                </div>

                <div class="col-sm-6 col-lg-6">
                    <div class="card text-white bg-flat-color-6">
                        <div class="card-body">
                            <div class="card-left pt-1 float-left">
                                <h3 id="alarmRate" class="mb-0 fw-r">
                                    <!--<span class="count float-left">{{ data.todayAlarmCount / data.equipmentCount * 100  if data.equipmentCount != 0 else 0 }}</span>
                                    <span>%</span>-->
                                </h3>
                                <p class="text-light mt-1 m-0">今日报警比例</p>
                            </div><!-- /.card-left -->

                            <div class="card-right float-right text-right">
                                <div id="flotBar1" class="flotBar1"></div>
                            </div><!-- /.card-right -->

                        </div>

                    </div>
                </div>

                <div class="col-sm-6 col-lg-6">
                    <div class="card text-white bg-flat-color-2">
                        <div class="card-body">
                            <div class="card-left pt-1 float-left">
                                <h3 id="failRate" class="mb-0 fw-r">
                                    <!--<span class="count">{{ data.todayFaultCount / data.equipmentCount * 100 if data.equipmentCount != 0 else 0}}</span>
                                    <span>%</span>-->
                                </h3>
                                <p class="text-light mt-1 m-0">今日故障比例</p>
                            </div><!-- /.card-left -->

                            <div class="card-right float-right text-right">
                                <div id="flotLine1" class="flotLine1"></div>
                            </div><!-- /.card-right -->

                        </div>

                    </div>
                </div>
            </div>



            <div class="col">
                <div class="card">
                    <div class="card-header">
                        <strong class="card-title">告警信息统计</strong>
                    </div>
                    <div class="card-body">
                        <table class="table table-striped">
                            <thead>
                            <tr>
                                <th scope="row">当前报警数</th>
                                <td id="alarmTotal"></td>
                                <!--<td id="alarmTotal">{{ data.nowAlarmCount }}</td>-->
                                <td></td>
                                <td></td>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <th scope="row">当前故障数</th>
                                <td id="failTotal"></td>
                                <!--<td>{{ data.nowFaultCount }}</td>-->
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <th scope="row">今日报警数</th>
                                <td id="alarmTody"></td>
                                <!--<td>{{ data.todayAlarmCount }}</td>-->
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <th scope="row">今日故障数</th>
                                <td id="failTody"></td>
                                <!-- <td>{{ data.todayFaultCount }}</td>-->
                                <td></td>
                                <td></td>
                            </tr>

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>

        <div class="col">
            <div class="card">
                <div class="card-body">
                    <h4 class="mb-3">近期报警统计</h4>
                    <div class="flot-container">
                        <div id="chart1" style="width:100%; height:275px"></div>
                    </div>
                </div>
            </div><!-- /# card -->
        </div><!-- /# column -->
    </div><!-- .animated -->
</div>

<!-- Left Panel -->

<aside id="left-panel" class="left-panel">
    <nav class="navbar navbar-expand-sm navbar-default">

        <div id="main-menu" class="main-menu collapse navbar-collapse">
            <ul class="nav navbar-nav">
                <li class="menu-title">当前查看</li><!-- /.menu-title -->
                <li>
                    <a href="#" ><i class="menu-icon fa fa-laptop"></i><span id="currently"></span></a>
                </li>
                <li class="menu-title">监控管理</li><!-- /.menu-title -->
                <li>
                    <a href="monitor.html"><i class="menu-icon fa  fa-play-circle"></i>设备监控</a>
                </li>
                <li>
                    <a href="electrical.html"><i class="menu-icon fa  fa-play-circle"></i>电气监控</a>
                </li>
                <li>
                    <a href="data.html"><i class="menu-icon fa fa-bar-chart-o"></i>数据统计</a>
                </li>
                <li>
                    <a href="alarm_record.html"><i class="menu-icon fa fa-exclamation-circle"></i>报警记录</a>
                </li>

                <li class="menu-title">设备管理</li><!-- /.menu-title -->
                <li>
                    <a href="equipments.html"> <i class="menu-icon fa fa-cogs"></i>设备管理</a>
                </li>
            </ul>
        </div><!-- /.navbar-collapse -->
    </nav>
</aside><!-- /#left-panel -->

<!-- Left Panel -->

<!-- Right Panel -->

<div id="right-panel" class="right-panel" >

    <!-- Header-->
    <header id="header" class="header">
        <div class="top-left">
            <div class="navbar-header">
                <a id="menuToggle" class="menutoggle"><i class="fa fa-bars"></i></a>
                <a class="navbar-brand"><img style="height: 43px;margin-left: 25%" src="static/img/yunan_logo_2.png" alt="Logo"></a>
            </div>
        </div>
        <div class="top-right">
            <div class="header-menu">
                <div class="header-left">

                    <div class="dropdown for-notification">
                        <button class="btn btn-secondary dropdown-toggle" type="button" id="notification"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <!--<i class="fa fa-bell"></i>
                            <span id="count" class="count bg-danger"></span>-->
                        </button>
                        <div class="dropdown-menu" aria-labelledby="notification">
                            <p class="red">报警/故障信息</p>
                            <a id="tips" class="dropdown-item media" href="#">
                                <!--<i class="fa fa-check"></i>-->
                                <!--{% for tip in base.tips %}
                                <p>{{ tip }}</p>
                                {% endfor %}-->
                            </a>
                        </div>
                    </div>
                </div>

                <div class="user-area dropdown float-right">
                    <a href="#" class="dropdown-toggle active" data-toggle="dropdown" aria-haspopup="true"
                       aria-expanded="false">
                        <!-- <img class="user-avatar rounded-circle" src="{{ base.avatarImgUrl }}" alt="Avatar"> -->
                        <p id="base_name"></p>
                    </a>

                    <div class="user-menu dropdown-menu">
                        <li>
                            <a class="nav-link" href="editUser.html"><i class="fa fa-user"></i>账号信息</a>
                        </li>
                        <li>
                            <a class="nav-link" href="roles.html"><i class="fa fa-user"></i>角色管理</a>
                        </li>
                        <li>
                            <a class="nav-link" href="#"><i class="fa fa-cog"></i>设置</a>
                        </li>
                        <li>
                            <a class="nav-link" href="javascript:location.href='user/exit';"><i class="fa fa-power-off"></i>退出</a>

                        </li>

                    </div>
                </div>
            </div>
        </div>
    </header><!-- /header -->
    <!-- Header-->

    <div class="clearfix"></div>

    <footer class="site-footer" >
        <div class="footer-inner bg-white">
            <div class="row">
                <div class="col-sm-6" >
                    Copyright &copy; 2020 易宁安全监测平台
                </div>
                <div class="col-sm-6 text-right"> 高能团队
                </div>
            </div>
        </div>
    </footer>
</div><!-- /#right-panel -->



<!-- Right Panel -->
</body>
</html>
<!--
{% extends 'base.html' %}

{% block content %}


{% endblock %}

{% block js %}




{% endblock %}
-->
