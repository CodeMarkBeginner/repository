<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>设备管理</title>
    <meta name="description" content="Ela Admin - HTML5 Admin Template">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="static/assets/css/normalize.css">
    <link rel="stylesheet" href="static/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="static/assets/css/font-awesome.min.css">
    <link rel="stylesheet" href="static/assets/css/themify-icons.css">
    <link rel="stylesheet" href="static/assets/css/pe-icon-7-filled.css">
    <link rel="stylesheet" href="static/assets/css/flag-icon.min.css">
    <link rel="stylesheet" href="static/assets/css/cs-skin-elastic.css">
    <link rel="stylesheet" href="static/assets/css/lib/datatable/dataTables.bootstrap.min.css">
    <link rel="stylesheet" href="static/assets/css/style.css">

    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800' rel='stylesheet' type='text/css'>

    <!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/html5shiv/3.7.3/html5shiv.min.js"></script> -->

    <style>
        .amap-icon img,
        .amap-marker-content img{
            width: 45px;
            height: 45px;
        }
        /*label的样式*/
        .amap-marker-label{
            position: absolute;
            z-index: 2;
            border: 1px solid #ccc;
            background-color: white;
            　white-space: nowrap;
            　cursor: default;
            　padding: 3px;
            　font-size: 12px;
            　line-height: 14px;
        }
        /*字的颜色*/
        .navbar .navbar-nav li > a {
            width: 100%;
            max-width: 100%;
            font-size: 14px;
            color: #707070;
        }

        /* 以下是设备监控、电气监控、数据统计、报警记录、设备管理前页面的css */
        /* 自己创建一个css然后放进去，我怕打乱你文件顺序就全放在这了 */
        /* 设备监控 */
        .amap-icon img,
        .amap-marker-content img{
            width: 45px;
            height: 45px;
        }
        /*label的样式*/
        .amap-marker-label{
            position: absolute;
            z-index: 2;
            border: 1px solid #ccc;
            background-color: white;
            　white-space: nowrap;
            　cursor: default;
            　padding: 3px;
            　font-size: 12px;
            　line-height: 14px;
        }

    </style>
    <!-- Scripts -->
    <script src="static/assets/js/jquery-2.1.0.min.js"></script>
    <script src="static/assets/js/vendor/jquery-2.1.4.min.js"></script>
    <script src="static/assets/js/popper.min.js"></script>

    <script src="static/assets/js/jquery.matchHeight.min.js"></script>
    <script src="static/assets/js/main.js"></script>
    <script src="static/assets/js/jquery-2.1.0.min.js"></script>
    <script src="static/assets/js/getParameter.js"></script>
    <script src="static/assets/js/lib/data-table/datatables.min.js"></script>
    <script src="static/assets/js/lib/data-table/dataTables.bootstrap.min.js"></script>
    <script src="static/assets/js/lib/data-table/dataTables.buttons.min.js"></script>
    <script src="static/assets/js/lib/data-table/buttons.bootstrap.min.js"></script>
    <script src="static/assets/js/lib/data-table/jszip.min.js"></script>
    <script src="static/assets/js/lib/data-table/vfs_fonts.js"></script>
    <script src="static/assets/js/lib/data-table/buttons.html5.min.js"></script>
    <script src="static/assets/js/lib/data-table/buttons.print.min.js"></script>
    <script src="static/assets/js/lib/data-table/buttons.colVis.min.js"></script>
    <script src="static/assets/js/init/datatables-init.js"></script>


    <script >
        $(document).ready(function () {
            var name = getParameter("name");
            var pageSize = getParameter("pageSize");

            var cooki = document.cookie;

            //获取页码数据展示条数
            if (cooki != ""){
                cooki = "{\"" + cooki + "\"}";
                cooki = cooki.replace(/\s*/g, "").replace(/=/g, '":"').replace(/;/g, '","');
                var json = eval("(" + cooki + ")"); //将coolies转成json对象
                document.getElementById("mySelect").options[json.index].selected = true;
                if (pageSize == null){
                    pageSize = document.getElementById("mySelect").options[json.index].value;
                    //alert(pageSize)
                }
            }
            if (pageSize == null){
                pageSize = 10;
            }
            if(name){
                name = window.decodeURIComponent(name);
            }
            if (name == null){
                name = "";
            }


            load(null, pageSize, name, null, null);


        });


        function load(currentPage, pageSize, name, infor, sta) {
            var name;
            var pageSize;
            var subBtn = document.getElementById("form1");
            var obj = document.getElementById("mySelect");
            var valuename = document.getElementById("name");

            if (valuename.value.length != 0 ){
                subBtn.onsubmit = function () {
                    name = valuename.value;
                    //alert(name);
                    obj.onchange = function () {
                        //var obj = $("#select option:selected");
                        //alert(obj)
                        var index = obj.selectedIndex;
                        document.cookie = 'index='+index;
                        //alert(obj.options[index])
                        pageSize = obj.options[index].value;
                        //pageSize = obj.val();
                        //alert(pageSize);

                    };
                };
            }else {

                obj.onchange = function () {

                    var index = obj.selectedIndex;

                    pageSize = obj.options[index].value;
                    document.cookie = 'index='+index;
                    //alert(pageSize);
                    document.form1.submit();
                };

            }

            //发送ajax请求
            $.get("equipListServlet",{currentPage:currentPage, pageSize:pageSize, name:name, infor:infor, sta:sta},function (pb) {
                $.get("findUserServlet", {}, function (users) {
                    $.get("findRoleServlet", {}, function (list) {
                        for (var k = 1; k <= pb.list.length + 1; k++){
                            for (var i = 1; i <= users.length; i++){
                                for (var j = 1; j <= list.length; j++)
                                {
                                    if (pb.list[k-1].uid == users[i-1].uid && users[i-1].rid == list[j-1].rid && list[j-1].aeq == 1){
                                        $("#add").attr("href", "addEquipment.html?uid="+pb.list[k-1].uid)

                                    }
                                    if (pb.list[k-1].uid == users[i-1].uid && users[i-1].rid == list[j-1].rid && list[j-1].aeq == 0) {
                                        $("#add").click(function () {
                                            alert("对不起，您没有添加设备权限！！！");
                                        });
                                    }
                                    if (pb.list[k-1].uid == users[i-1].uid && users[i-1].rid == list[j-1].rid && list[j-1].ueq == 1) {
                                        $("#mid"+k+"").attr("href", "editEquipment.html?eq_id="+ pb.list[k-1].eq_id);

                                    }
                                    else if (pb.list[k-1].uid == users[i-1].uid && users[i-1].rid == list[j-1].rid && list[j-1].ueq == 0) {
                                        $("#mid"+k+"").click(function () {
                                            alert("对不起，您没有修改设备权限！！！")

                                        });

                                    }

                                }
                            }

                        }
                    })
                });


                //解析pageBean数据，展示到页面上
                //分页栏展示
                $("#start").html((pb.currentPage - 1) * pageSize + 1);
                $("#end").html(pageSize*pb.currentPage < pb.totalCount ? pageSize*pb.currentPage : pb.totalCount);
                $("#totalCount").html(pb.totalCount);
                //页码展示
                var list = '';
                //alert(pb.currentPage)
                var beforeNum = (pb.currentPage <= 1) ? 1 : (pb.currentPage - 1);
                var previous = '<li onclick="javascript:load('+beforeNum+','+pageSize+',\''+name+'\')">\n' +
                    '                        <a href="javascript:void(0);" aria-label="Previous">\n' +
                    '                            <span aria-hidden="true" href="">Previous</span>\n' +
                    '                        </a>\n' +
                    '                    </li>';
                list += previous;

                //展示分页页码使得展示的页码为10
                var begin;
                var end;
                //1、显示10个页面
                if(pb.totalPage < 10){
                    //总页码小于10页
                    begin = 1;
                    end = pb.totalPage;
                }else {
                    //总页码大于10页
                    begin = pb.currentPage - 5;
                    end = pb.currentPage + 4;

                    //如果前边不够5个，后边补齐10个
                    if (begin < 1){
                        begin = 1;
                        end = begin + 9;
                    }
                    if (end > pb.totalPage){
                        end = pb.totalPage;
                        begin = end - 9;
                    }
                }
                for (var i = begin; i <= end; i++) {
                    var li ;
                    if (i == pb.currentPage){
                        li = '<li class="active" onclick="javascript:load('+i+','+pageSize+',\''+name+'\')"><a href="javascript:void(0);">'+i+'</a></li>';
                    }else {
                        li = '<li onclick="javascript:load('+i+','+pageSize+',\''+name+'\')"><a href="javascript:void(0);">'+i+'</a></li>';
                    }

                    list += li;
                }
                var afterNum = (pb.currentPage + 1 > pb.totalPage) ? pb.totalPage : (pb.currentPage + 1)
                var next = '<li onclick="javascript:load('+afterNum+','+pageSize+',\''+name+'\')">\n' +
                    '                        <a href="javascript:void(0);" aria-label="Next">\n' +
                    '                            <span aria-hidden="true">Next</span>\n' +
                    '                        </a>\n' +
                    '                    </li>';
                list += next;
                $("#pageNum").html(list);
                var lis = '<tr>\n' +
                    '                        <th>#</th>\n' +
                    '                        <th>设备名称</th>\n' +
                    '                        <th>状态</th>\n' +
                    '                        <th>使用单位</th>\n' +
                    '                        <th>设备地址</th>\n' +
                    '                        <th>联系人</th>\n' +
                    '                        <th>联系电话</th>\n' +
                    '                        <th>生产商</th>\n' +
                    '                        <th>型号</th>\n' +
                    '                        <th>SIM_id</th>\n' +
                    '                        <th>安装日期</th>\n' +
                    '                        <th>备注</th>\n' +
                    '                        <th>操作</th>\n' +
                    '                    </tr>';
                for (var i = 1; i < pb.list.length + 1; i++) {
                    var inform = pb.list[i-1];
                    var tr = '<tr>\n' +
                        '                            <td>'+(i+(pb.currentPage-1)*pageSize)+'</td>\n' +
                        '                            <td>'+(inform.name == null ? "" : inform.name)+'</td>\n' +
                        '                            <td>'+(inform.status == null ? "" : inform.status)+'</td>\n' +
                        '                            <td>'+(inform.use_department == null ? "": inform.use_department)+'</td>\n' +
                        '                            <td>'+(inform.address == null ? "" : inform.address)+'</td>\n' +
                        '                            <td>'+(inform.contact == null ? "" : inform.contact)+'</td>\n' +
                        '                            <td>'+(inform.contact_tel == null ? "" : inform.contact_tel)+'</td>\n' +
                        '                            <td>'+(inform.producer == null ? "" : inform.producer)+'</td>\n' +
                        '                            <td>'+(inform.type == null ? "" : inform.type)+'</td>\n' +
                        '                            <td>'+(inform.sim_id == null ? "" : inform.sim_id)+'</td>\n' +
                        '                            <td>'+(inform.install_time == null ? "" : inform.install_time)+'</td>\n' +
                        '                            <td>'+(inform.note == null ? "" : inform.note)+'</td>\n' +
                        '                            <td><a class="btn btn-default btn-sm" id=\"cid'+i+'\" href="logEquipment.html?eq_id='+inform.eq_id+'">检测</a>\n' +
                        '                                <a class="btn btn-default btn-sm" id=\"cid'+i+'\" href="control.html?eq_id='+inform.eq_id+'">控制</a>\n' +
                        '                                <a class="btn btn-default btn-sm" id=\"mid'+i+'\">修改</a></td>\n' +
                        '                        </tr>';
                    lis += tr;
                }

                $("#manage").html(lis);

            });
        }


    </script>
</head>

<body>
<div class="right-panel">
<div class="animated fadeIn">
        <div class="row">

            <div class="col-md-12">
                <div class="card">
                    <div class="card-header" style="background-color: ;">
                        <strong class="card-title">设备列表</strong>
                        <a href="" id="add" name="add">
                            <button type="button" class="float-right btn btn-outline-primary btn-sm" >
                                <i class="fa fa-plus"></i>
                                &nbsp; 添加设备
                            </button>
                        </a>

                        &nbsp;&nbsp;&nbsp;
                    </div>
                    <div class="card-body">
                    <form id="form1" name="form1">
                        <select id="mySelect" name="pageSize">
                            <option value="10">10</option>
                            <option value="9">9</option>
                            <option value="8">8</option>
                            <option value="7">7</option>
                            <option value="6">6</option>
                            <option value="3">3</option>
                        </select>


                        <input id="name" type="text" name="name">

                    </form>

                        <table id="manage" class="table table-striped table-bordered">
                        </table>
                    </div>
                    <div>showing <span id="start"></span> to <span id="end"></span> of <span id="totalCount"></span> entries</div>
                    <div>
                        <nav aria-label="Page navigation">
                            <ul class="pagination" id="pageNum">
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>


        </div>
    </div><!-- .animated -->
<!-- Left Panel -->
</div>

<!--引入base-->
<div id="newbase"></div>
<!--导入布局js-->
<script type="text/javascript" src="static/assets/js/include.js"></script>

</body>
</html>

