<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>电气监控</title>
    <script src="static/assets/js/jquery-3.3.1.js"></script>
    <script src="static/assets/js/vendor/jquery-2.1.4.min.js"></script>
    <script src="static/assets/js/popper.min.js"></script>
    <script src="static/assets/js/bootstrap.min.js"></script>
    <script src="static/assets/js/jquery.matchHeight.min.js"></script>
    <script src="static/assets/js/main.js"></script>


    <script src="static/assets/js/lib/data-table/datatables.min.js"></script>
    <script src="static/assets/js/lib/data-table/dataTables.bootstrap.min.js"></script>
    <script src="static/assets/js/lib/data-table/dataTables.buttons.min.js"></script>
    <script src="static/assets/js/lib/data-table/buttons.bootstrap.min.js"></script>
    <script src="static/assets/js/lib/data-table/jszip.min.js"></script>
    <script src="static/assets/js/lib/data-table/vfs_fonts.js"></script>
    <script src="static/assets/js/lib/data-table/buttons.html5.min.js"></script>
    <script src="static/assets/js/lib/data-table/buttons.print.min.js"></script>
    <script src="static/assets/js/lib/data-table/buttons.colVis.min.js"></script>
    <script src="static/assets/js/init/datatables-init.js"></script>

    <link rel="stylesheet" href="static/assets/css/normalize.css">
    <link rel="stylesheet" href="static/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="static/assets/css/font-awesome.min.css">
    <link rel="stylesheet" href="static/assets/css/themify-icons.css">
    <link rel="stylesheet" href="static/assets/css/pe-icon-7-filled.css">
    <link rel="stylesheet" href="static/assets/css/flag-icon.min.css">
    <link rel="stylesheet" href="static/assets/css/cs-skin-elastic.css">
    <link rel="stylesheet" href="static/assets/css/lib/datatable/dataTables.bootstrap.min.css">
    <link rel="stylesheet" href="static/assets/css/style.css">

    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800' rel='stylesheet' type='text/css'>

    <script src="http://echarts.baidu.com/build/dist/echarts.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>


    <script>
        $(function () {

            $.get("monitor/findTipToday",null,function (tipToday) {
                var ps = '<i class="fa fa-check"></i>';
                for (var i = 0; i < tipToday.length; i++) {
                    var tip = tipToday[i];
                    var p ='<p>'+tip.eq_name+'发生'+tip.type+'</p> <br/> ';
                    ps += p;
                }
                $("#tips").html(ps);
                var count = '<i class="fa fa-bell"></i> <span id="count" class="count bg-danger">'+tipToday.length+'</span>';
                $("#notification").html(count);
            });
        });
    </script>
    <script type="text/javascript">

        $(function () {

            //loginuser:现登录用户
            $.get("user/findOne",{},function (luser) {
                fusername=luser.username;
                uid=luser.uid;
                $("#base_name").html(luser.name);
            });

            var li = '<a href="#"><i class="menu-icon fa fa-laptop"></i>电气监控</a>';
            $("#now").html(li);

            // 声明电压电流图表变量
            let voltage, current;
            $.get("monitor/findEle",{id:1},function (ele) {

                voltages = ele[0][0];
                currents = ele[1][0];
                // 路径配置
                require.config({
                    paths: {
                        echarts: 'http://echarts.baidu.com/build/dist'
                    }
                });
                // 使用
                require(
                    [
                        'echarts',
                        'echarts/chart/line', // 使用柱状图就加载bar模块，按需加载
                        'echarts/chart/bar',
                    ],
                    function (ec) {
                        // 基于准备好的dom，初始化echarts图表
                        voltage = ec.init(document.getElementById('voltage'));
                        var option = {
                            title : {
                                text: '电压电流监测'
                            },
                            tooltip: {
                                trigger: 'axis',
                                axisPointer: {
                                    type: 'cross',
                                    crossStyle: {
                                        color: '#999'
                                    }
                                }
                            },
                            legend: {
                                data: ['电压', '电流']
                            },
                            toolbox: {
                                show : true,
                                feature : {
                                    mark : {show: true},
                                    dataView : {show: true, readOnly: false},
                                    restore : {show: true},
                                    saveAsImage : {show: true}
                                }
                            },
                            calculable : true,
                            xAxis: [
                                {
                                    type: 'category',
                                    data: ['13：00','14：00', '15：00','16：00', '17：00','18：00', '19：00', '20：00','21：00', '22：00','23：00','0：00', '1：00','2：00', '3：00','4：00', '5：00','6：00', '7：00','8：00', '9：00', '10：00','11：00','12：00'],
                                    axisPointer: {
                                        type: 'shadow'
                                    }
                                }
                            ],
                            yAxis: [
                                {
                                    type: 'value',
                                    name: '电压',
                                    min: 0,
                                    max: 250,
                                    interval: 50,
                                    axisLabel: {
                                        formatter: '{value} V'
                                    }
                                },
                                {
                                    type: 'value',
                                    name: '电流',
                                    min: 0,
                                    max: 10,
                                    interval: 2,
                                    axisLabel: {
                                        formatter: '{value} A'
                                    }
                                }
                            ],
                            series: [
                                {
                                    name: '电压',
                                    type: 'line',
                                    itemStyle: {

                                        normal: {
                                            color: "#ffb630",
                                            lineStyle: {
                                                color: "#496a23"
                                            }
                                        }
                                    },
                                    data: [voltages.v_13, voltages.v_14, voltages.v_15,  voltages.v_16, voltages.v_17, voltages.v_18, voltages.v_19,
                                        voltages.v_20, voltages.v_21, voltages.v_22, voltages.v_23,  voltages.v_00, voltages.v_01, voltages.v_02,
                                        voltages.v_03, voltages.v_04, voltages.v_05, voltages.v_06, voltages.v_07, voltages.v_08, voltages.v_09,
                                        voltages.v_10, voltages.v_11, voltages.v_12]
                                },
                                {
                                    name: '电流',
                                    type: 'line',
                                    yAxisIndex: 1,
                                    itemStyle: {
                                        normal: {
                                            color: "#7a2d59",
                                            lineStyle: {
                                                color: "#dbc804"
                                            }
                                        }
                                    },
                                    data: [currents.c_13, currents.c_14, currents.c_15, currents.c_16, currents.c_17, currents.c_18 ,currents.c_19 ,
                                        currents.c_20 ,currents.c_21 ,currents.c_22, currents.c_23, currents.c_00, currents.c_01, currents.c_02,
                                        currents.c_03, currents.c_04, currents.c_05, currents.c_06, currents.c_07, currents.c_08, currents.c_09,
                                        currents.c_10, currents.c_11, currents.c_12]
                                }
                            ]
                        };


                        // 为echarts对象加载数据
                        voltage.setOption(option);
                    }
                );

            });

            $.get("monitor/findEle",{id:1},function (ele) {

                voltages = ele[0][0];
                currents = ele[1][0];
                // 路径配置
                require.config({
                    paths: {
                        echarts: 'http://echarts.baidu.com/build/dist'
                    }
                });
                // 使用
                require(
                    [
                        'echarts',
                        'echarts/chart/line', // 使用柱状图就加载bar模块，按需加载
                        'echarts/chart/bar',
                    ],
                    function (ec) {
                        // 基于准备好的dom，初始化echarts图表
                        current = ec.init(document.getElementById('current'));
                        var option = {
                            title : {
                                text: '电压电流监测'
                            },
                            tooltip: {
                                trigger: 'axis',
                                axisPointer: {
                                    type: 'cross',
                                    crossStyle: {
                                        color: '#999'
                                    }
                                }
                            },
                            legend: {
                                data: ['电压', '电流']
                            },
                            toolbox: {
                                show : true,
                                feature : {
                                    mark : {show: true},
                                    dataView : {show: true, readOnly: false},
                                    restore : {show: true},
                                    saveAsImage : {show: true}
                                }
                            },
                            calculable : true,
                            xAxis: [
                                {
                                    type: 'category',
                                    data: ['13：00','14：00', '15：00','16：00', '17：00','18：00', '19：00', '20：00','21：00', '22：00','23：00','0：00', '1：00','2：00', '3：00','4：00', '5：00','6：00', '7：00','8：00', '9：00', '10：00','11：00','12：00'],
                                    axisPointer: {
                                        type: 'shadow'
                                    }
                                }
                            ],
                            yAxis: [
                                {
                                    type: 'value',
                                    name: '电压',
                                    min: 0,
                                    max: 250,
                                    interval: 50,
                                    axisLabel: {
                                        formatter: '{value} V'
                                    }
                                },
                                {
                                    type: 'value',
                                    name: '电流',
                                    min: 0,
                                    max: 10,
                                    interval: 2,
                                    axisLabel: {
                                        formatter: '{value} A'
                                    }
                                }
                            ],
                            series: [
                                {
                                    name: '电压',
                                    type: 'bar',
                                    itemStyle: {

                                        normal: {
                                            color: "#bb496b",
                                            lineStyle: {
                                                color: "#bb496b"
                                            }
                                        }
                                    },
                                    data: [voltages.v_13, voltages.v_14, voltages.v_15,  voltages.v_16, voltages.v_17, voltages.v_18, voltages.v_19,
                                        voltages.v_20, voltages.v_21, voltages.v_22, voltages.v_23,  voltages.v_00, voltages.v_01, voltages.v_02,
                                        voltages.v_03, voltages.v_04, voltages.v_05, voltages.v_06, voltages.v_07, voltages.v_08, voltages.v_09,
                                        voltages.v_10, voltages.v_11, voltages.v_12]
                                },
                                {
                                    name: '电流',
                                    type: 'bar',
                                    yAxisIndex: 1,
                                    itemStyle: {
                                        normal: {
                                            color: "#37419a",
                                            lineStyle: {
                                                color: "#fc801c"
                                            }
                                        }
                                    },
                                    data: [currents.c_13, currents.c_14, currents.c_15, currents.c_16, currents.c_17, currents.c_18 ,currents.c_19 ,
                                        currents.c_20 ,currents.c_21 ,currents.c_22, currents.c_23, currents.c_00, currents.c_01, currents.c_02,
                                        currents.c_03, currents.c_04, currents.c_05, currents.c_06, currents.c_07, currents.c_08, currents.c_09,
                                        currents.c_10, currents.c_11, currents.c_12]
                                }
                            ]
                        };



                        // 为echarts对象加载数据
                        current.setOption(option);
                    }
                );

            });

            // 更新图标数据
            function refreshData(chart, data, timeLabel){
                if(!chart){
                    return;
                }

                //更新数据
                var option = chart.getOption();
                option.series[0].data.shift();
                option.series[0].data.push(data);
                option.xAxis[0].data.shift();
                option.xAxis[0].data.push(timeLabel);
                chart.setOption(option);
            }

            // socket
            var socket = io.connect('http://' + document.domain + ':' + location.port);
            socket.on('connect', function(data) {
                console.log('--> Client connect successed', data);
            });
            // 报警
            socket.on('uireport', function(data, callback) {
                console.log(data);

                refreshData(voltage, data['U1'], data['datetime'].subtring(12,17));
                refreshData(voltage, data['I1'], data['datetime'].subtring(12,17));

                callback(1);
            });
            socket.on('join', function(data, callback) {
                console.log(data);

            });
            socket.on('jump', function(data, callback) {
                console.log(data);
                callback(1);
            });



        });



    </script>


</head>

<body>

<div class="right-panel">
    <div class="animated fadeIn">
        <div class="row">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-body">
                        <div id="voltage" style="height: 300px;"></div>
                    </div>
                </div>
            </div><!-- /# column -->
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-body">
                        <div id="current" style="height: 300px;"></div>
                    </div>
                </div>
            </div><!-- /# column -->
        </div>
    </div><!-- .animated -->
</div>

<!-- Left Panel -->

<aside id="left-panel" class="left-panel">
    <nav class="navbar navbar-expand-sm navbar-default">

        <div id="main-menu" class="main-menu collapse navbar-collapse">
            <ul class="nav navbar-nav">
                <div class="container-fluid">
                    <div class="accordion" id="accordion2">
                        <div class="accordion-group" style="padding-left: 30px">
                            <li class="menu-title accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseOne">当前查看</li>
                            <li id="collapseOne" class="accordion-body collapse" style="height: 0px;">
                                <a href="#"><i class="menu-icon fa fa-laptop"></i>base</a>
                            </li>
                        </div>
                        <div class="accordion-group" style="padding-left: 30px">
                            <li class="menu-title accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseTwo">监控管理</li><!-- /.menu-title -->
                            <li id="collapseTwo" class="accordion-body collapse">
                                <a href="monitor.html"><i class="menu-icon fa  fa-play-circle"></i>设备监控</a>
                                <a href="electrical.html"><i class="menu-icon fa  fa-play-circle"></i>电气监控</a>
                                <a href="data.html"><i class="menu-icon fa fa-bar-chart-o"></i>数据统计</a>
                                <a href="alarm_record.html"><i class="menu-icon fa fa-exclamation-circle"></i>报警记录</a>
                            </li>
                        </div>
                        <div class="accordion-group"style="padding-left: 30px">
                            <li class="menu-title accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseThree">设备管理</li><!-- /.menu-title -->
                            <li id="collapseThree" class="accordion-body collapse" >
                                <a href="equipments.html"> <i class="menu-icon fa fa-cogs"></i>设备管理</a>
                            </li>
                        </div>
                        <li class="menu-title" style="padding-left: 30px">敬请期待</li>
                    </div>
                </div>

            </ul>
        </div><!-- /.navbar-collapse -->
    </nav>
</aside><!-- /#left-panel -->

<!-- Left Panel -->

<!-- Right Panel -->

<div id="right-panel" class="right-panel" >

    <!-- Header-->
    <header id="header" class="header">
        <div class="top-left">
            <div class="navbar-header">
                <a id="menuToggle" class="menutoggle"><i class="fa fa-bars"></i></a>
                <a class="navbar-brand" href="monitor.html"><img style="height: 43px;margin-left: 25%" src="static/img/yining_logo.png" alt="Logo"></a>
            </div>
        </div>
        <div class="top-right">
            <div class="header-menu">
                <div class="header-left">

                    <div class="dropdown for-notification">
                        <button class="btn btn-secondary dropdown-toggle" type="button" id="notification"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <!--<i class="fa fa-bell"></i>
                            <span id="count" class="count bg-danger"></span>-->
                        </button>
                        <div class="dropdown-menu" aria-labelledby="notification">
                            <p class="red">报警/故障信息</p>
                            <a id="tips" class="dropdown-item media" href="#">
                                <!--<i class="fa fa-check"></i>-->
                                <!--{% for tip in base.tips %}
                                <p>{{ tip }}</p>
                                {% endfor %}-->
                            </a>
                        </div>
                    </div>
                </div>

                <div class="user-area dropdown float-right">
                    <a href="#" class="dropdown-toggle active" data-toggle="dropdown" aria-haspopup="true"
                       aria-expanded="false">
                        <!-- <img class="user-avatar rounded-circle" src="{{ base.avatarImgUrl }}" alt="Avatar"> -->
                        <p id="base_name"></p>
                    </a>

                    <div class="user-menu dropdown-menu">
                        <li>
                            <a class="nav-link" href="editUser.html"><i class="fa fa-user"></i>账号信息</a>
                        </li>
                        <li>
                            <a class="nav-link" href="roles.html"><i class="fa fa-user"></i>角色管理</a>
                        </li>
                        <li>
                            <a class="nav-link" href="#"><i class="fa fa-cog"></i>设置</a>
                        </li>
                        <li>
                            <a class="nav-link" href="javascript:location.href='user/exit';"><i class="fa fa-power-off"></i>退出</a>

                        </li>
                    </div>
                </div>
            </div>
        </div>
    </header><!-- /header -->
    <!-- Header-->
    <div class="clearfix"></div>

    <footer class="site-footer" >
        <div class="footer-inner bg-white">
            <div class="row">
                <div class="col-sm-6" >
                    Copyright &copy; 2020 易宁安全监测平台
                </div>
                <div class="col-sm-6 text-right"> 高能团队
                </div>
            </div>
        </div>
    </footer>
</div><!-- /#right-panel -->



<!-- Scripts -->


</body>
</html>

