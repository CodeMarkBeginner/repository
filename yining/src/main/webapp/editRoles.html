<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>修改角色</title>
    <meta name="description" content="Ela Admin - HTML5 Admin Template">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="http://libs.baidu.com/jquery/2.1.4/jquery.min.js"></script>

    <link rel="stylesheet" href="static/assets/css/normalize.css">
    <link rel="stylesheet" href="static/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="static/assets/css/bootstrapp.css">
    <link rel="stylesheet" href="static/assets/css/font-awesome.min.css">
    <link rel="stylesheet" href="static/assets/css/themify-icons.css">
    <link rel="stylesheet" href="static/assets/css/pe-icon-7-filled.css">
    <link rel="stylesheet" href="static/assets/css/flag-icon.min.css">
    <link rel="stylesheet" href="static/assets/css/cs-skin-elastic.css">
<!--    <link rel="stylesheet" href="static/assets/css/lib/datatable/dataTables.bootstrap.min.css">-->
    <link rel="stylesheet" href="static/assets/css/style.css">

    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800' rel='stylesheet' type='text/css'>

    <!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/html5shiv/3.7.3/html5shiv.min.js"></script> -->

    <script>
        function getParameter(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)","i");
            var r = location.search.substr(1).match(reg);
            if (r!=null) return (r[2]); return null;
        }
        $(function () {
            var rid =getParameter("rid");
            load();
            for (var i=1;i<3;i++){
                $("#updateFront"+i).html("修改");
                $("#updateFront"+i).click(function() {
                    var  j=$(this).attr("res");
                    if(j==0){
                        $(this).attr("res","1");
                        $(this).html("修改");
                        $(this).parent().prev().children().attr("disabled",true);

                        //传参修改每行数据
                        var val=$(this).parent().prev().attr("class");
                        if (val == "rn") {
                            var rname=$("#rname").val();
                            $.post("updateRoleServlet",{rid:rid,rname:rname},function () {

                            })
                        }else if(val=="rem"){
                            var remark=$("#remark").val();
                            $.post("updateRoleServlet",{rid:rid,remark:remark},function () {

                            })
                        }
                    }else{
                        $(this).attr("res","0");
                        $(this).html("确定");
                        $(this).parent().prev().children().attr("disabled",false);
                    }
                    return false;
                });
            }
            for (var i=3;i<10;i++){
                $("#updateFront"+i).html("修改");
                $("#updateFront"+i).click(function() {
                    var  j=$(this).attr("res");
                    if(j==0){
                        $(this).attr("res","1");
                        $(this).html("修改");

                        //传参修改每行数据
                        var val=$(this).parent().prev().attr("class");
                        if (val == "rl") {
                            var rli=$("#rli").html();
                            if(rli=="是"){
                                rli=1;
                            }else if(rli=="否"){
                                rli=0;
                            }
                            $.post("updateRoleServlet",{rid:rid,rli:rli},function () {

                            })
                        }else if(val=="ae"){
                            var aeq=$("#aeq").html();
                            if(aeq=="是"){
                                aeq=1;
                            }else if(aeq=="否"){
                                aeq=0;
                            }
                            $.post("updateRoleServlet",{rid:rid,aeq:aeq},function () {

                            })
                        }else if (val=="ue"){
                            var ueq=$("#ueq").html();
                            if(ueq=="是"){
                                ueq=1;
                            }else if(ueq=="否"){
                                ueq=0;
                            }
                            $.post("updateRoleServlet",{rid:rid,ueq:ueq},function () {

                            })
                        }else if (val=="de"){
                            var deq=$("#deq").html();
                            if(deq=="是"){
                                deq=1;
                            }else if(deq=="否"){
                                deq=0;
                            }
                            $.post("updateRoleServlet",{rid:rid,deq:deq},function () {

                            })
                        }else if (val=="asub"){
                            var asub_account=$("#asub_account").html();
                            if(asub_account=="是"){
                                asub_account=1;
                            }else if(asub_account=="否"){
                                asub_account=0;
                            }
                            $.post("updateRoleServlet",{rid:rid,asub_account:asub_account},function () {

                            })
                        } else if (val=="usub"){
                            var usub_account=$("#usub_account").html();
                            if(usub_account=="是"){
                                usub_account=1;
                            }else if(usub_account=="否"){
                                usub_account=0;
                            }
                            $.post("updateRoleServlet",{rid:rid,usub_account:usub_account},function () {

                            })
                        } else if (val=="dsub"){
                            var dsub_account=$("#dsub_account").html();
                            if(dsub_account=="是"){
                                dsub_account=1;
                            }else if(dsub_account=="否"){
                                dsub_account=0;
                            }
                            $.post("updateRoleServlet",{rid:rid,dsub_account:dsub_account},function () {

                            })
                        }

                    }else{
                        $(this).attr("res","0");
                        $(this).html("确定");

                        //修改权限
                        if($(this).parent().prev().children().html()=="否"){
                            $(this).parent().prev().children().html("是");
                        }else if($(this).parent().prev().children().html()=="是"){
                            $(this).parent().prev().children().html("否");
                        }
                    }
                    return false;
                });
            }

            //发送请求updateRoleServlet
            $.get("perRoleServlet",{rid:rid},function (role) {
                //解析数据填充html
                $("#rname").attr("value",role.rname);
                $("#remark").attr("value",role.remark);
                if (role.rli==1) {
                    $("#rli").html("是");
                }else{
                    $("#rli").html("否");
                }
                if (role.aeq==1) {
                    $("#aeq").html("是");
                }else{
                    $("#aeq").html("否");
                }
                if (role.ueq==1) {
                    $("#ueq").html("是");
                }else{
                    $("#ueq").html("否");
                }
                if (role.deq==1) {
                    $("#deq").html("是");
                }else{
                    $("#deq").html("否");
                }
                if (role.asub_account==1) {
                    $("#asub_account").html("是");
                }else{
                    $("#asub_account").html("否");
                }
                if (role.usub_account==1) {
                    $("#usub_account").html("是");
                }else{
                    $("#usub_account").html("否");
                }
                if (role.dsub_account==1) {
                    $("#dsub_account").html("是");
                }else{
                    $("#dsub_account").html("否");
                }
                var datefmt=format(role.date,"yyyy-MM-dd hh:mm:ss");
                $("#date").html(datefmt);

            })
        });

        //时间格式自定义
        function format(datetime,fmt) {
            if (parseInt(datetime)==datetime) {
                if (datetime.length==10) {
                    datetime=parseInt(datetime)*1000;
                } else if(datetime.length==13) {
                    datetime=parseInt(datetime);
                }
            }
            datetime=new Date(datetime);
            var o = {
                "M+" : datetime.getMonth()+1,                 //月份
                "d+" : datetime.getDate(),                    //日
                "h+" : datetime.getHours(),                   //小时
                "m+" : datetime.getMinutes(),                 //分
                "s+" : datetime.getSeconds(),                 //秒
                "q+" : Math.floor((datetime.getMonth()+3)/3), //季度
                "S"  : datetime.getMilliseconds()             //毫秒
            };
            if(/(y+)/.test(fmt))
                fmt=fmt.replace(RegExp.$1, (datetime.getFullYear()+"").substr(4 - RegExp.$1.length));
            for(var k in o)
                if(new RegExp("("+ k +")").test(fmt))
                    fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : (("00"+ o[k]).substr((""+ o[k]).length)));
            return fmt;
        }

        function load() {
            //2.table数据展示
            var role='<tr>\n' +
                '                        <td style="vertical-align: middle">角色名称</td>\n' +
                '                        <td  class="rn">\n' +
                '                            <input id="rname" name="rname" disabled="disabled" value="" style="border: none;background: white">\n' +
                '                        </td>\n' +
                '                        <td>\n' +
                '                            <a href="" id="updateFront1"></a>\n' +
                '                        </td>\n' +
                '                    </tr>\n' +
                '                    <tr>\n' +
                '                        <td style="vertical-align: middle">备注</td>\n' +
                '                        <td class="rem">\n' +
                '                            <input value="" name="remark" disabled="disabled" id="remark" style="border: none;background: white">\n' +
                '                        </td>\n' +
                '                        <td>\n' +
                '                            <a href="" id="updateFront2"></a>\n' +
                '                        </td>\n' +
                '                    </tr>\n' +
                '                    <tr>\n' +
                '                        <td style="vertical-align: middle">添加角色权限</td>\n' +
                '                        <td class="rl">\n' +
                '                            <span id="rli"></span>\n' +
                '                        </td>\n' +
                '                        <td>\n' +
                '                            <a href="" id="updateFront3"></a>\n' +
                '                        </td>\n' +
                '                    </tr>\n' +
                '                    <tr>\n' +
                '                        <td style="vertical-align: middle">添加设备权限</td>\n' +
                '                        <td class="ae">\n' +
                '                            <span id="aeq"></span>\n' +
                '                        </td>\n' +
                '                        <td>\n' +
                '                            <a href="" id="updateFront4"></a>\n' +
                '                        </td>\n' +
                '                    </tr>\n' +
                '                    <tr>\n' +
                '                        <td style="vertical-align: middle">修改设备权限</td>\n' +
                '                        <td class="ue">\n' +
                '                            <span id="ueq"></span>\n' +
                '                        </td>\n' +
                '                        <td>\n' +
                '                            <a href="" id="updateFront5"></a>\n' +
                '                        </td>\n' +
                '                    </tr>\n' +
                '                    <tr>\n' +
                '                        <td style="vertical-align: middle">删除设备权限</td>\n' +
                '                        <td class="de">\n' +
                '                            <span id="deq"></span>\n' +
                '                        </td>\n' +
                '                        <td>\n' +
                '                            <a href="" id="updateFront6"></a>\n' +
                '                        </td>\n' +
                '                    </tr>\n' +
                '                    <tr>\n' +
                '                        <td style="vertical-align: middle">添加子账号权限</td>\n' +
                '                        <td class="asub">\n' +
                '                            <span id="asub_account"></span>\n' +
                '                        </td>\n' +
                '                        <td>\n' +
                '                            <a href="" id="updateFront7"></a>\n' +
                '                        </td>\n' +
                '                    </tr>\n' +
                '                    <tr>\n' +
                '                        <td style="vertical-align: middle">修改子账号权限</td>\n' +
                '                        <td class="usub">\n' +
                '                            <span id="usub_account"></span>\n' +
                '                        </td>\n' +
                '                        <td>\n' +
                '                            <a href="" id="updateFront8"></a>\n' +
                '                        </td>\n' +
                '                    </tr>\n' +
                '                    <tr>\n' +
                '                        <td style="vertical-align: middle">删除子账号权限</td>\n' +
                '                        <td class="dsub">\n' +
                '                            <span id="dsub_account"></span>\n' +
                '                        </td>\n' +
                '                        <td>\n' +
                '                            <a href="" id="updateFront9"></a>\n' +
                '                        </td>\n' +
                '                    </tr>\n' +
                '                    <tr>\n' +
                '                        <td style="vertical-align: middle">创建时间</td>\n' +
                '                        <td>\n' +
                '                            <span id="date"></span>\n' +
                '                        </td>\n' +
                '                        <td>\n' +
                '\n' +
                '                        </td>\n' +
                '                    </tr>'
            $("#updateRoles").html(role);
        }
    </script>

    <style>
        .amap-icon img,
        .amap-marker-content img{
            width: 45px;
            height: 45px;
        }
        /*label的样式*/
        .amap-marker-label{
            position: absolute;
            z-index: 2;
            border: 1px solid #ccc;
            background-color: white;
            　white-space: nowrap;
            　cursor: default;
            　padding: 3px;
            　font-size: 12px;
            　line-height: 14px;
        }
        /*字的颜色*/
        .navbar .navbar-nav li > a {
            width: 100%;
            max-width: 100%;
            font-size: 14px;
            color: #707070;
        }

        /* 以下是设备监控、电气监控、数据统计、报警记录、设备管理前页面的css */
        /* 自己创建一个css然后放进去，我怕打乱你文件顺序就全放在这了 */
        /* 设备监控 */
        .amap-icon img,
        .amap-marker-content img{
            width: 45px;
            height: 45px;
        }
        /*label的样式*/
        .amap-marker-label{
            position: absolute;
            z-index: 2;
            border: 1px solid #ccc;
            background-color: white;
            　white-space: nowrap;
            　cursor: default;
            　padding: 3px;
            　font-size: 12px;
            　line-height: 14px;
        }

    </style>

</head>

<body>
<!-- Left Panel -->
<div class="right-panel">
    <div class="content">
        <div class="content">
            <form class="" style="">
                <div class="panel panel-primary" style="overflow: hidden;border-color: #ff9933">
                    <div class="panel-heading" style="background-color: #ff9933;border-color: #ff9933">角色修改</div>
                    <br><br>
                    <div class="panel panel-default" style="width: 94%;margin:0 auto">
                        <!-- Table -->
                        <table class="table" id="updateRoles">

                        </table>
                    </div>
                </div>
            </form>
            <div class="panel panel-primary" style="overflow: hidden;border: #ff9933">
                <div class="panel-heading" style="background-color: #ff9933;border-color: #ff9933">用户管理</div>
                <br><br>
                <div class="panel panel-default" style="width: 94%;margin: 0 auto">
                    <!-- Table -->
                    <table class="table" style="" id="roles">
                        <tr>
                            <th>#</th>
                            <th>用户名称</th>
                            <th>地址</th>
                            <th>创建时间</th>
                        </tr>
                        <tr>
                            <td>1</td>
                            <td>学校</td>
                            <td></td>
                            <td>2020.3.2</td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>校区</td>
                            <td>三大校区</td>
                            <td>2020.1.3</td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>设备</td>
                            <td></td>
                            <td>2020.3.4</td>
                        </tr>
                    </table>
                </div>
                <nav aria-label="..." style="float: right;margin-right: 3%">
                    <ul class="pagination">
                        <li class="disabled"><a href="#" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a></li>
                        <li class="active"><a href="#">1 <span class="sr-only">(current)</span></a></li>
                        <li class=""><a href="#">2 <span class="sr-only">(current)</span></a></li>
                        <li class=""><a href="#">3 <span class="sr-only">(current)</span></a></li>
                        <li class=""><a href="#">4 <span class="sr-only">(current)</span></a></li>
                        <li class="disabled"><a href="#" aria-label="Previous"><span aria-hidden="true">&raquo;</span></a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</div>


<!--引入base-->
<div id="newbase"></div>
<!--导入布局js-->
<script type="text/javascript" src="static/assets/js/include.js"></script>

</body>

</html>