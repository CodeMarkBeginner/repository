<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>设备监控</title>
    <script src="static/assets/js/jquery-3.3.1.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=1.0&type=webgl&ak=7anKfCgYUKCMC9L6oryeGYtbDFg62VXz"></script>
    <!--<script src="static/assets/js/vendor/jquery-2.1.4.min.js"></script>-->
    <!-- &lt;!&ndash;导入布局js，共享base&ndash;&gt;
     <script type="text/javascript" src="static/assets/js/include.js"></script>
     <script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
     <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>

     <meta name="description" content="Ela Admin - HTML5 Admin Template">
     <meta name="viewport" content="width=device-width, initial-scale=1">-->

    <link rel="stylesheet" href="static/assets/css/normalize.css">
    <link rel="stylesheet" href="static/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="static/assets/css/font-awesome.min.css">
    <link rel="stylesheet" href="static/assets/css/themify-icons.css">
    <link rel="stylesheet" href="static/assets/css/pe-icon-7-filled.css">
    <link rel="stylesheet" href="static/assets/css/flag-icon.min.css">
    <link rel="stylesheet" href="static/assets/css/cs-skin-elastic.css">
    <link rel="stylesheet" href="static/assets/css/lib/datatable/dataTables.bootstrap.min.css">
    <link rel="stylesheet" href="static/assets/css/style.css">

    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800' rel='stylesheet' type='text/css'>

    <!--<script src="static/assets/js/vendor/jquery-2.1.4.min.js"></script>
    <script src="static/assets/js/popper.min.js"></script>
    <script src="static/assets/js/bootstrap.min.js"></script>
    <script src="static/assets/js/jquery.matchHeight.min.js"></script>
    <script src="static/assets/js/main.js"></script>-->


    <script src="static/assets/js/lib/data-table/datatables.min.js"></script>
    <script src="static/assets/js/lib/data-table/dataTables.bootstrap.min.js"></script>
    <script src="static/assets/js/lib/data-table/dataTables.buttons.min.js"></script>
    <script src="static/assets/js/lib/data-table/buttons.bootstrap.min.js"></script>
    <script src="static/assets/js/lib/data-table/jszip.min.js"></script>
    <script src="static/assets/js/lib/data-table/vfs_fonts.js"></script>
    <script src="static/assets/js/lib/data-table/buttons.html5.min.js"></script>
    <script src="static/assets/js/lib/data-table/buttons.print.min.js"></script>
    <script src="static/assets/js/lib/data-table/buttons.colVis.min.js"></script>
    <script src="static/assets/js/init/datatables-init.js"></script>


<style>
    .amap-icon img,
    .amap-marker-content img{
        width: 45px;
        height: 45px;
    }
    /*label的样式*/
    .amap-marker-label{
        position: absolute;
        z-index: 2;
        border: 1px solid #ccc;
        background-color: white;
      　white-space: nowrap;
      　cursor: default;
      　padding: 3px;
      　font-size: 12px;
      　line-height: 14px;
    }
    /*字的颜色*/
    .navbar .navbar-nav li > a {
        width: 100%;
        max-width: 100%;
        font-size: 14px;
        color: #707070;
    }
    /* 以下是设备监控、电气监控、数据统计、报警记录、设备管理前页面的css */
    /* 自己创建一个css然后放进去，我怕打乱你文件顺序就全放在这了 */
    /* 设备监控 */
    .amap-icon img,
    .amap-marker-content img{
        width: 45px;
        height: 45px;
    }
    /*label的样式*/
    .amap-marker-label{
        position: absolute;
        z-index: 2;
        border: 1px solid #ccc;
        background-color: white;
        　white-space: nowrap;
        　cursor: default;
        　padding: 3px;
        　font-size: 12px;
        　line-height: 14px;
    }
</style>

    <script>

        $(function () {

            load();
        });

        function load() {
            //发送ajax请求，请求monitor/findEquipment
            $.get("monitor/findEquipment",null,function (equipments) {




                var trs = "";
                for (var i = 0; i < equipments.length; i++) {
                    //获取数据
                    var eq = equipments[i];

                    var arr = new Array();
                    arr = eq.datetime.split('.');
                    eq.datetime = arr[0];

                    var tr = '<tr>\n' +
                        '        <td scope=\'row\'>'+eq.eq_id+'</td>\n' +
                        '        <td id=\'{{ e.id }}-datetime\'>'+eq.datetime+'</td>\n' +
                        '        <td id=\'{{ e.id }}-name\'>'+eq.name+'</td>\n' +
                        '        <td id=\'{{ e.id }}-status\'>'+eq.status+'</td>\n' +
                        '        <td id=\'{{ e.id }}-use_department\'>'+eq.use_department+'</td>\n' +
                        '        <td id=\'{{ e.id }}-eequipment_class\'>'+eq.equipment_class+'</td>\n' +
                        '        <td id=\'{{ e.id }}-location\'>'+eq.address+'</td>\n' +
                        '        <td id=\'{{ e.id }}-contact\'>'+eq.contact+'</td>\n' +
                        '        <td id=\'{{ e.id }}-contact_tel\'>'+eq.contact_tel+'</td>\n' +
                        '        </tr>';
                    trs += tr;
                }
                $("#equipment").html(trs);

                var li = '<a href="#"><i class="menu-icon fa fa-laptop"></i>设备监控</a>';
                $("#now").html(li);
            });


        }



    </script>

    <script type="text/javascript">
        var points = [];
        $.get("monitor/findEquipment",null,function (equipments) {
            points = equipments;

            //建立坐标点：
            /*
            //创建标注点的信息集合
            points = [
                {"longitude":112.58,"latitude":26.89,"name":"科技楼","use_department":"明向校区","status":"报警"},
                {"longitude":112.59,"latitude":26.90,"name":"科技楼","use_department":"明向校区","status":"故障"},
                {"longitude":112.57,"latitude":26.88,"name":"大数据学院","use_department":"明向校区","status":"off"}
            ];*/

            var map = new BMapGL.Map("vmap");    //创建地图实例
            var point = new BMapGL.Point(112.55, 37.87);   //创建点坐标
            map.centerAndZoom(point, 9);     //初始化地图，设置中心点坐标和地图级别
            map.enableScrollWheelZoom(true);    //开启鼠标滑轮缩放
            map.setHeading(64.5);   //设置地图旋转角度
            map.setTilt(73);      //设置地图的倾斜角度
            var scaleCtrl = new BMapGL.ScaleControl();  // 添加比例尺控件
            map.addControl(scaleCtrl);
            var zoomCtrl = new BMapGL.ZoomControl();  // 添加比例尺控件
            map.addControl(zoomCtrl);
            addMarker(points);


            //创建标注点并添加到地图中
            function addMarker(points) {

                //循环建立标注点
                for(var i=0, pointsLen = points.length; i<pointsLen; i++) {
                    var redIcon = new BMapGL.Icon(
                        'static/img/mapPoint/1.png',
                        new BMapGL.Size(26,30)
                    );
                    var yellowIcon = new BMapGL.Icon(
                        'static/img/mapPoint/2.png',
                        new BMapGL.Size(26,30)
                    );
                    var blueIcon = new BMapGL.Icon(
                        'static/img/mapPoint/3.png',
                        new BMapGL.Size(26,30)
                    );
                    var greenIcon = new BMapGL.Icon(
                        'static/img/mapPoint/4.png',
                        new BMapGL.Size(26,30)
                    );
                    var point = new BMapGL.Point(points[i].longitude, points[i].latitude); //将标注点转化成地图上的点

                    var marker;

                    if (points[i].status == '报警' || points[i].status == "电压报警"){

                        marker = new BMapGL.Marker(point, {icon:redIcon}); //将点转化成标注点
                    }
                    else if (points[i].status == '故障'){
                        marker = new BMapGL.Marker(point, {icon:yellowIcon});
                    }
                    else if (points[i].status == 'off'){
                        marker = new BMapGL.Marker(point, {icon:blueIcon});
                    }
                    else{
                        marker = new BMapGL.Marker(point, {icon:greenIcon});
                    }

                    /*
                    var label = new BMapGL.Label(points[i].count,
                        {offset: new BMapGL.Size(-5,-10)});
                    label.setStyle({
                        background:'none',color:'#ffffff',border:'none'
                    });
                    marker.setLabel(label);*/

                    map.addOverlay(marker);  //将标注点添加到地图上

                    //添加监听事件
                    (function() {
                        var thePoint = points[i];

                        marker.addEventListener("click",
                            //显示信息的方法
                            function() {
                                showInfo(this,thePoint);

                            });
                    })();
                }
            }
            function showInfo(thisMarker,point) {

                //获取点的信息
                var sContent =
                    '<ul style="margin:0 0 5px 0;padding:0.2em 0; font-weight: bold; color: #707070; ">'
                    +'<li style="line-height: 26px;font-size: 15px; ">'
                    +'<span style="width: 80px;display: inline-block; ">设备名称:</span>' + point.name + '</li>'
                    +'<li style="line-height: 26px;font-size: 15px; ">'
                    +'<span style="width: 80px;display: inline-block;">使用单位:</span>' + point.use_department + '</li>'
                    +'<li style="line-height: 26px;font-size: 15px; ">'
                    +'<span style="width: 80px;display: inline-block;">设备状态:</span>'+ point.status +'</li>'
                    +'</ul>';
                var opt = {
                    width: 180,
                    height: 90,
                    title: "设备信息"
                };
                var infoWindow = new BMapGL.InfoWindow(sContent, opt); //创建信息窗口对象

                thisMarker.openInfoWindow(infoWindow); //图片加载完后重绘infoWindow
            }
        });



    </script>


</head>

<body>


  <!--      <div class="content">-->
        <div class="right-panel">
            <div class="animated fadeIn">
                <div class="row">

                    <div class="col-md-12">
                        <div class="card">
                            <div class="Vector-map-js">
                                <div id="vmap" class="vmap">

                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-body">
                                <table id="" class="table table-striped">
                                    <thead>
                                        <tr>
                                            <!-- <th scope='col' style='display: none'>id</th> -->
                                            <th scope='col'>#</th>
                                            <th scope='col'>接收时间</th>
                                            <th scope='col'>设备名称</th>
                                            <th scope='col'>状态</th>
                                            <th scope='col'>单位</th>
                                            <th scope='col'>系统类型</th>
                                            <th scope='col'>部件地址</th>
                                            <th scope='col'>联系人</th>
                                            <th scope='col'>联系电话</th>
                                        </tr>
                                    </thead>
                                    <tbody id="equipment">
                                        <!--<tr>
                                            <td scope='row'>{{ loop.index}}</td>
                                            &lt;!&ndash; <td id='{{ e.id }}' style="display: none">{{ e.id }}</td> &ndash;&gt;
                                            <td id='{{ e.id }}-datetime'>{{ e.datetime }}</td>
                                            <td id='{{ e.id }}-name'>{{ e.name or '' }}</td>
                                            <td id='{{ e.id }}-status'>{{ e.status or 'off' }}</td>
                                            <td id='{{ e.id }}-use_department'>{{ e.use_department or ''}}</td>
                                            <td id='{{ e.id }}-eequipment_class'>{{ e.class_  or ''}}</td>
                                            <td id='{{ e.id }}-location'>{{ e.location or '' }}</td>
                                            <td id='{{ e.id }}-contact'>{{ e.contact or '' }}</td>
                                            <td id='{{ e.id }}-contact_tel'>{{ e.contact_tel or '' }}</td>
                                        </tr>
                                        {% endfor %}-->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>


                </div>
            </div><!-- .animated -->
        </div><!-- .content -->

  <!--引入base-->
  <div id="newbase"></div>
  <!--导入布局js-->
  <script type="text/javascript" src="static/assets/js/include.js"></script>

</body>
</html>

